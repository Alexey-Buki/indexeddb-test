(this["webpackJsonpindexeddb-test"]=this["webpackJsonpindexeddb-test"]||[]).push([[0],{12:function(e,t,n){},14:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(5),c=n.n(o),s=(n(12),n(1)),i=n.n(s),l=n(2),u=n(6),d=n(3),f=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;function p(e,t){return new Promise((function(n,r){var a=f.open(e,t);a.addEventListener("blocked",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.warn("blobcked",t)})),a.addEventListener("error",(function(e){r()})),a.addEventListener("success",(function(e){n(a.result)})),a.addEventListener("upgradeneeded",(function(e){var t=e.target.result;t.addEventListener("error",(function(){r()})),t.addEventListener("close",(function(e){console.error(e),alert("close")})),t.createObjectStore("file_storage",{keyPath:"id",autoIncrement:!0}).createIndex("id","id")}))}))}function v(e,t){return m.apply(this,arguments)}function m(){return(m=Object(l.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var a=null;console.log("start write transaction");var o=t.transaction(["file_storage"],"readwrite");o.addEventListener("abort",(function(e){console.error("an abort transaction write",e,o),r(e)})),o.addEventListener("error",(function(e){console.error("an error transaction write",e,o),r(e)})),o.addEventListener("complete",(function(t){console.log("complete transaction",t,o),e(a)}));var c=o.objectStore("file_storage");console.log("put file",n);var s=c.put(n);s.addEventListener("success",(function(e){a=s.result,console.log("id = "+a),console.log("write: object store request success",e,s,c)})),s.addEventListener("error",(function(e){console.error("write: object store request error",e,s,c)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,t){return new Promise((function(n,r){var a=null;console.log("start read transaction");var o=e.transaction(["file_storage"],"readonly");o.addEventListener("abort",(function(e){console.error("an abort transaction read",e,o),r(e)})),o.addEventListener("error",(function(e){console.error("an error transaction read",e,o),r(e)})),o.addEventListener("complete",(function(e){console.log("complete read transaction",e,o),n(a)}));var c=o.objectStore("file_storage");console.log("get file",t);var s=c.get(t);s.addEventListener("success",(function(e){a=s.result,console.log("read: object store request success",e,s,c)})),s.addEventListener("error",(function(e){console.error("read: object store request error",e,s,c)}))}))}function g(e){return new Promise((function(t,n){var r=[];console.log("start read all transaction");var a=e.transaction(["file_storage"],"readonly");a.addEventListener("abort",(function(e){console.error("an abort transaction read all",e,a),n(e)})),a.addEventListener("error",(function(e){console.error("an error transaction read all",e,a),n(e)})),a.addEventListener("complete",(function(e){console.log("complete read all transaction",e,a),t(r)}));var o=a.objectStore("file_storage").getAll();o.addEventListener("success",(function(e){console.log("request get all",e),r=o.result})),o.addEventListener("error",(function(e){console.error("error request get all",e),n(e)}))}))}function E(e){return w.apply(this,arguments)}function w(){return(w=Object(l.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p("test",1);case 2:return n=e.sent,e.next=5,v(n,t);case 5:return r=e.sent,e.next=8,b(n,r);case 8:if(e.sent instanceof Blob&&0!==t.size){e.next=11;break}throw new Error("can not save file");case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return x.apply(this,arguments)}function x(){return(x=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p("test",1);case 2:return t=e.sent,e.abrupt("return",g(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return new Promise((function(e,t){try{var n=f.deleteDatabase("test");n.addEventListener("error",(function(e){console.error("error remove db:"+e),t(e)})),n.addEventListener("success",(function(r){if(!n.result)return console.log("remove db:"+r),e(r);console.error("went wrong"+r),t("went wrong"+r)}))}catch(r){t(r)}}))}n(14);function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=1024,r=t<0?0:t,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,o)).toFixed(r))+" "+a[o]}var k=function(){var e=Object(r.useState)([]),t=Object(d.a)(e,2),n=t[0],o=t[1],c=Object(r.useState)(0),s=Object(d.a)(c,2),f=s[0],p=s[1],v=Object(r.useState)(null),m=Object(d.a)(v,2),b=m[0],g=m[1],w=Object(r.useState)({}),x=Object(d.a)(w,2),k=x[0],L=x[1];function O(){return(O=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.files[0],e.prev=1,!n){e.next=11;break}return e.next=5,E(n);case 5:return e.t0=o,e.next=8,h();case 8:e.t1=e.sent,(0,e.t0)(e.t1),g(n);case 11:e.next=17;break;case 13:e.prev=13,e.t2=e.catch(1),console.error(e.t2),alert(e.t2);case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function B(){return(B=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!b){e.next=14;break}t=0;case 3:if(!(t<f)){e.next=9;break}return e.next=6,E(b);case 6:++t,e.next=3;break;case 9:return e.t0=o,e.next=12,h();case 12:e.t1=e.sent,(0,e.t0)(e.t1);case 14:e.next=20;break;case 16:e.prev=16,e.t2=e.catch(0),console.error(e.t2),alert(e.t2);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}function S(){return(S=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:o([]);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(r.useEffect)((function(){Promise.resolve().then((function(){return Promise.all([navigator.storage.persist(),navigator.storage.persisted(),navigator.storage.estimate()])})).then((function(e){var t=Object(d.a)(e,3),n=t[0],r=t[1],a=t[2];L(Object(u.a)({persist:n,persisted:r},a))})).catch(console.error)}),[n]),Object(r.useEffect)((function(){h().then((function(e){o(e)}))}),[]);var P=Object.keys(k.usageDetails||{}).map((function(e){return a.a.createElement("li",{key:e},e,": ",j(k.usageDetails[e]))}));return a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"item"},a.a.createElement("button",{type:"button",onClick:function(){return S.apply(this,arguments)}},"Clear"),a.a.createElement("ul",null,a.a.createElement("li",null,"persist: ",String(k.persist)),a.a.createElement("li",null,"persisted: ",String(k.persisted)),a.a.createElement("li",null,"quota: ",j(k.quota)),a.a.createElement("li",null,"usege: ",j(k.usage)),a.a.createElement("li",null,"usege: ",a.a.createElement("ol",null,P)))),a.a.createElement("div",{className:"item"},a.a.createElement("div",null,a.a.createElement("label",null,"Input file: "),a.a.createElement("input",{type:"file",onChange:function(e){return O.apply(this,arguments)}})),a.a.createElement("div",null,a.a.createElement("label",null,"Input file: "),a.a.createElement("input",{type:"text",value:f,onChange:function(e){p(e.target.value)}}),a.a.createElement("button",{type:"button",onClick:function(){return B.apply(this,arguments)}},"Save")),a.a.createElement("div",null,a.a.createElement("h2",null,"Count ",n.length),a.a.createElement("ul",null,n.map((function(e){return a.a.createElement("li",{key:e.id},e.name)}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(k,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},7:function(e,t,n){e.exports=n(15)}},[[7,1,2]]]);
//# sourceMappingURL=main.597690b7.chunk.js.map